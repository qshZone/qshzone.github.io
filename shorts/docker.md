---
layout: page
title: Docker справочник
---

Полезные ссылки
- [Docker документация](https://docs.docker.com/)

Сущности
- image (образ) - readonly образ приложения
- container (контейнер) - работающее приложение на основе образа
- volume (том) - файл или каталог, который хранится вне контейнера и подключается к нему	
- dockerfile - файл описания образа
- слой - выполнение каждой команды в Dockerfile
- hub - облачное [хранилище](https://hub.docker.com) для образов


## Общие команды

Установка Docker на Linux `curl -sSL https://get.docker.com/ | sh`, `sudo apt install docker`


## Основные команды

Формат вызова команды `docker <command>`
- `build` - сборка образа по файлу `Dockerfile`  
Пример: `docker build . -t some-app`
- `images` - список доступных образов в репозитории
- `search <query>` - поиск в Docker Hub
- `pull <image name>` - загрузить образ из репозитория
- `push <image name>` - загрузить образ в репозиторий
- `run` - запуск контейнера, с параметром  
--rm - удаляет контейнер после завершения работы  
-it - интерактивно можно видеть весь вывод на консоль  
-p - переадресация портов в порядке на какой-откуда (пример `8080:80`)  
-d - запускает в фоновом режиме контейнер с возвращением в командную строку  
-v - поделючение тома, пример `-v "/home/foo/data:/data"`  
--name - имя образа, указывается самым последним, если не указать, то генерируется автоматически  
- `ps` - список запущенных контейнеров  
-a - список с уже запускавшимися контейнерами  
- `exec` - выполнение команды внутри контейнера  
-it - переход на командную строку внутри контейнера, например, `exec -it <id> /bin/bash`, а для выхода из bash используется `exit`
- `start/stop <container name>`
- `rmi <image id>` - удаление образа
- `rm <container id or name>` - удаление контейнера по идентификатору или имени
- `history` - история образа
- `logs <name>` - логи контейнера
- `inspect <container name>` - получение информации по контейнеру

Полезные команды
- `docker run --rm -it -p 8080:80 lps-app` - запуск контейнера с приложением, которое будет доступно на порту 8080 и контейнер будет удалён после остановки приложения по `Ctrl+C`
- `docker container prune` - очищает список контейнеров, которые не запущены
- `docker rm $(docker ps -qa)` - передача id всех контейнеров для удаления
- `docker build . -t some-app --build-arg <varname>=<value>` - построить образ с указанием переменных


## Dockerfile - сборка образа

Файл Dockerfile служит для описания шагов для формирования образа, который получается после билда файла.

При выполнении каждой команды создаётся новый слой, все эти слои могут выполняться параллельно.

Команды `Dockerfile`
- `FROM` - используемый образ
- `RUN` - запуск по командной строке  
Примеры: `mkdir -p /usr/src/app/`, `dotnet build "App.csproj" -c Release -o /app/build`
- `WORKDIR` - 
- `COPY` - 
- `CMD` - что нужно сделать, когда контейнер будет запущен, запускается через оболочку shell  
Пример: `CMD ["python, "app.py"]`
- `ENTRYPOINT` - выполняется без shell оболочки  
Пример: `ENTRYPOINT ["python, "app.py"]`


## Compose - сборка образа на основе сторонних образов




## Разное

- Где хранятся файлы образов на диске?
- Передача параметров в образ/в контейнер

